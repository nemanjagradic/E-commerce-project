const item1 = {
  id: 1,
  img: ['img/chair-1.png', 'img/chair-2.png', 'img/chair-3.png'],
  title: 'Kimme Chair',
  description:
    'Kyuzo is a capsule collection of desk aKyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '1.5kg',
  dimensions: '700 x 500 x 800 cm',
  size: 'M',
  price: 95,
  quantity: 1,
  category: 'chairs',
};
const item2 = {
  id: 2,
  img: ['img/teacaddy-1.png', 'img/teacaddy-2.png'],
  title: 'Kimme Tea Caddy',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '0.2 kg',
  dimensions: '35 x 50 x 40cm',
  price: 30,
  quantity: 1,
  category: 'other',
};
const item3 = {
  id: 3,
  img: ['img/earphonecase-1.png', 'img/earphonecase-2.png'],
  title: 'Earphone Case',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '0.2 kg',
  dimensions: '100 x 50 x 40 cm',
  price: 25,
  quantity: 1,
  category: 'other',
};
const item4 = {
  id: 4,
  img: ['img/table-1.png', 'img/table-2.png'],
  title: 'Horrison Table',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '	1.5 kg',
  dimensions: '35 x 200 x 230 cm',
  price: 350,
  quantity: 1,
  category: 'tables',
};
const item5 = {
  id: 5,
  img: ['img/clock-1.jpg'],
  title: 'Wallnut Wall Clock',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '	0.2 kg',
  dimensions: '700 x 200 x 800 cm',
  price: 35,
  quantity: 1,
  category: 'clocks',
};
const item6 = {
  id: 6,
  img: ['img/roundtable-1.png'],
  title: 'Arper Round Table',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '1.7 kg',
  dimensions: '700 x 20 x 230 cm',
  price: 200,
  quantity: 1,
  category: 'tables',
};
const item7 = {
  id: 7,
  img: ['img/yamanami chair-1.png'],
  title: 'Yamanami Chair',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '	2.5 kg',
  dimensions: '1530 x 800 x 1250 cm',
  price: 200,
  quantity: 1,
  category: 'chairs',
};
const item8 = {
  id: 8,
  img: ['img/vase-1.jpg', 'img/vase-2.jpg'],
  title: 'Concrete Vase',
  description:
    'Donec accumsan auctor iaculis. Sed suscipit arcu ligula, at egestas magna molestie a. Proin ac ex maximus, ultrices justo eget, sodales orci.',
  weight: '0.2 kg',
  dimensions: '35 x 50 x 20 cm',
  price: 120,
  quantity: 1,
  category: 'other',
};
const item9 = {
  id: 9,
  img: ['img/oak-chair-1.jpg', 'img/oak-chair-2.jpg'],
  title: 'Oak Wooden Chair',
  description:
    'Donec accumsan auctor iaculis. Sed suscipit arcu ligula, at egestas magna molestie a. Proin ac ex maximus, ultrices justo eget, sodales orci.',
  weight: '1.5kg',
  dimensions: '700 x 500 x 800 cm',
  size: 'S',
  price: 60,
  quantity: 1,
  category: 'chairs',
};
const item10 = {
  id: 10,
  img: ['img/takata-clock-1.png'],
  title: 'Takata lemnos clock',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '	0.4 kg',
  dimensions: '	50 x 60 x 30 cm',
  price: 50,
  quantity: 1,
  category: 'clocks',
};
const item11 = {
  id: 11,
  img: ['img/ottoman-chair-1.png'],
  title: 'Ottoman Chair',
  description:
    'Kyuzo is a capsule collection of desk and home accessories, driven by materiality and designed to provide divisions of space through subtle hierarchies.',
  weight: '1.8 kg',
  dimensions: '700 x 500 x 20 cm',
  price: 80,
  quantity: 1,
  category: 'chairs',
};
const item12 = {
  id: 12,
  img: ['img/task-pendant-black-1.jpg'],
  title: 'Task Pendant Black',
  description:
    'Donec accumsan auctor iaculis. Sed suscipit arcu ligula, at egestas magna molestie a. Proin ac ex maximus, ultrices justo eget, sodales orci.',
  weight: '0.8 kg',
  dimensions: '35 x 50 x 40 cm',
  price: 110,
  quantity: 1,
  category: 'lamps',
};
const item13 = {
  id: 13,
  img: ['img/task-pendant-gold-1.jpg'],
  title: 'Task Pendant Gold',
  description:
    'Donec accumsan auctor iaculis. Sed suscipit arcu ligula, at egestas magna molestie a. Proin ac ex maximus, ultrices justo eget, sodales orci.',
  weight: '0.8 kg',
  dimensions: '35 x 50 x 40 cm',
  price: 110,
  quantity: 1,
  category: 'lamps',
};
const item14 = {
  id: 14,
  img: ['img/task-pendant-grey-1.jpg'],
  title: 'Task Pendant Grey',
  description:
    'Donec accumsan auctor iaculis. Sed suscipit arcu ligula, at egestas magna molestie a. Proin ac ex maximus, ultrices justo eget, sodales orci.',
  weight: '0.8 kg',
  dimensions: '35 x 50 x 40 cm',
  price: 110,
  quantity: 1,
  category: 'lamps',
};
const items = [
  item1,
  item2,
  item3,
  item4,
  item5,
  item6,
  item7,
  item8,
  item9,
  item10,
  item11,
  item12,
  item13,
  item14,
];

const addTotalPrice = function () {
  items.forEach(item => {
    item.totalPrice = item.price * item.quantity;
  });
};
addTotalPrice();

const nav = document.querySelector('.nav');

const obsCallback = function (entries) {
  const [entry] = entries;
  console.log(entry);

  if (!entry.isIntersecting) {
    nav.classList.add('sticky');
  } else {
    nav.classList.remove('sticky');
  }
};

const obsOptions = {
  root: null,
  threshold: 0,
};

const stickyNavObserver = new IntersectionObserver(obsCallback, obsOptions);
const gridContainer = document.querySelector('.grid-container');
stickyNavObserver.observe(gridContainer);

const menu = document.querySelector('.menu');
const navSide = document.querySelector('.nav-side');
console.log(menu.firstElementChild);

const showNav = function (btn) {
  btn.addEventListener('click', function () {
    if (navSide.classList.contains('show-nav')) {
      navSide.classList.remove('show-nav');
      menu.innerHTML = '';
      menu.innerHTML = '<i class="fa-solid fa-bars"></i>';
    } else {
      navSide.classList.add('show-nav');
      menu.innerHTML = '';
      menu.innerHTML = '<i class="fa-solid fa-xmark"></i>';
    }
  });
};
showNav(menu);

const createProductItems = function () {
  items
    .slice(0, 6)
    .map(item => {
      productsView.render(item, false);
    })
    .join('');
};

createProductItems();

const createTrendingItems = function () {
  trendingView.render(items);
};

createTrendingItems();

const productList = document.querySelector('.product-list');
const trendingList = document.querySelector('.trending-now');

const goToPage = function (items) {
  const productEls = document
    .querySelector('.product-list')
    .querySelectorAll('.product-item');

  const trendingEls = trendingList.querySelectorAll('.trending-item');
  const itemsEl = [...productEls, ...trendingEls];
  itemsEl.forEach(item => {
    item.addEventListener('click', function (e) {
      const tag = e.target.closest('a');
      const id = +tag.dataset.id;
      const currentItem = items.find(item => item.id === id);
      localStorage.setItem('currentItem', JSON.stringify(currentItem));
    });
  });
};

goToPage(items);

const initItems = function () {
  localStorage.setItem('allItems', JSON.stringify(items));
};
initItems();

const btnLeft = document.querySelector('.slider_btn-left');
const btnRight = document.querySelector('.slider_btn-right');
const slides = document.querySelectorAll('.trending-item');
let curSlide = 0;

const moveSlider = function (slide) {
  slides.forEach(s => {
    s.style.transform = `translateX(${100 * slide}%)`;
  });
};

const nextSlide = function () {
  if (curSlide === -3) {
    curSlide = 0;
  } else {
    curSlide--;
  }
  moveSlider(curSlide);
};

const prevSlide = function () {
  if (curSlide === 0) {
    curSlide = -3;
  } else {
    curSlide++;
  }
  moveSlider(curSlide);
};

btnLeft.addEventListener('click', prevSlide);
btnRight.addEventListener('click', nextSlide);

const shoppingCartIcon = document.querySelector('.shopping-cart-icon');
const closeCart = document.querySelector('.close-cart');
const shoppingCart = document.querySelector('.shopping-cart');
const overlay = document.querySelector('.overlay-2');
const subtotalEl = document.querySelector('.subtotal');
const shoppingIcon = document.querySelector('.shopping-items');

const showCart = function () {
  shoppingCartIcon.addEventListener('click', function () {
    shoppingCart.classList.remove('hide-cart');
    overlay.classList.remove('hidden');
  });
};
showCart();

const hideCart = function () {
  closeCart.addEventListener('click', function () {
    shoppingCart.classList.add('hide-cart');
    overlay.classList.add('hidden');
  });
  overlay.addEventListener('click', function () {
    shoppingCart.classList.add('hide-cart');
    overlay.classList.add('hidden');
  });
};
hideCart();

const initShoppingItems = function () {
  const storage = localStorage.getItem('shoppingItems');
  if (storage) shoppingCartItems = JSON.parse(storage);
};
initShoppingItems();

const loadShoppingItems = function () {
  window.addEventListener('load', function () {
    shoppingCartItems
      .map(item => {
        shoppingView.render(item, false);
      })
      .join('');

    quantityItemPlus();
    quantityItemMinus();
    renderSubtotal();
    deleteItem();
  });
};
loadShoppingItems();

const renderSubtotal = function () {
  subtotal = 0;
  shoppingCartItems.forEach(function (item) {
    subtotal = Number(subtotal + item.totalPrice);
    subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
  });
};

const quantityItemPlus = function () {
  const quantityButtons = document.querySelectorAll('.shopping-item-quantity');
  quantityButtons.forEach(btn => {
    btn.addEventListener('click', function (e) {
      const quantityPlus = e.target.closest('.increase-quantity');
      const quantity = quantityPlus.parentElement.querySelector('.quantity');
      const id = +quantity.dataset.id;
      const currentItem = shoppingCartItems.find(item => item.id === id);

      currentItem.quantity = currentItem.quantity + 1;
      quantity.textContent = currentItem.quantity;

      currentItem.totalPrice = currentItem.quantity * currentItem.price;
      const totalPrice = quantityPlus.parentElement.parentElement.querySelector(
        '.shopping-item-price'
      );
      totalPrice.textContent = `$${currentItem.totalPrice.toFixed(2)}`;

      renderSubtotal();
      persistShoppingItems();
    });
  });
};

const quantityItemMinus = function () {
  const quantityButtons = document.querySelectorAll('.shopping-item-quantity');
  quantityButtons.forEach(btn => {
    btn.addEventListener('click', function (e) {
      const quantityMinus = e.target.closest('.decrease-quantity');
      const quantity = quantityMinus.parentElement.querySelector('.quantity');
      const id = +quantity.dataset.id;
      const currentItem = shoppingCartItems.find(item => item.id === id);

      if (currentItem.quantity > 1)
        currentItem.quantity = currentItem.quantity - 1;
      quantity.textContent = currentItem.quantity;

      currentItem.totalPrice = currentItem.quantity * currentItem.price;
      const totalPrice =
        quantityMinus.parentElement.parentElement.querySelector(
          '.shopping-item-price'
        );
      totalPrice.textContent = `$${currentItem.totalPrice.toFixed(2)}`;

      renderSubtotal();
      persistShoppingItems();
    });
  });
};

const deleteItem = function () {
  const deleteEls = document.querySelectorAll('.delete-shopping-item');
  deleteEls.forEach(el => {
    el.addEventListener('click', function (e) {
      const item = e.target.closest('.shopping-cart-item');
      const itemId = +item.dataset.id;
      const currentItemIndex = shoppingCartItems.findIndex(
        item => item.id === itemId
      );
      shoppingCartItems.splice(currentItemIndex, 1);
      item.remove();
      persistShoppingItems();

      shoppingIcon.classList.remove('hidden');
      shoppingIcon.textContent = shoppingCartItems.length;
    });
  });
};

const persistShoppingItems = function () {
  localStorage.setItem('shoppingItems', JSON.stringify(shoppingCartItems));
};
